[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

# Redis configuration
[program:redis]
command=redis-server --port 6379
autostart=true
autorestart=true
stderr_logfile=/var/log/redis.err.log
stdout_logfile=/var/log/redis.out.log
priority=1
startsecs=5
stopasgroup=true

# Celery worker configuration
[program:celery]
command=bash -c "cd /app/backend && celery -A services.celery_tasks.celery_app worker --loglevel=info"
autostart=true
autorestart=true
stderr_logfile=/var/log/celery.err.log
stdout_logfile=/var/log/celery.out.log
priority=2
startsecs=10
stopasgroup=true
numprocs=1
process_name=%(program_name)s

# Next.js configuration
[program:nextjs]
command=bash -c "cd /app/frontend && npm start"
autostart=true
autorestart=true
stderr_logfile=/var/log/nextjs.err.log
stdout_logfile=/var/log/nextjs.out.log
priority=3
startsecs=15
stopasgroup=true
environment=NODE_ENV=production

# Uvicorn API server configuration
[program:uvicorn]
command=bash -c "cd /app/backend && uvicorn main:app --host 0.0.0.0 --port 8000 --access-log"
autostart=true
autorestart=true
stderr_logfile=/var/log/uvicorn.err.log
stdout_logfile=/var/log/uvicorn.out.log
priority=4
startsecs=10
stopasgroup=true
environment=PYTHONUNBUFFERED=1

# Group configuration
[group:services]
programs=redis,celery,nextjs,uvicorn

[unix_http_server]
file=/var/run/supervisor.sock

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

